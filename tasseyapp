import React, { useState } from 'react';

export default function GoalAffirmationApp() {
  const [goal, setGoal] = useState('');
  const [results, setResults] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  const analyzeGoal = (goalText) => {
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
    const extractKeywords = (text) => {
      const importantWords = text.match(/[ä¸€-é¾¥ã-ã‚“ã‚¡-ãƒ¶ãƒ¼]+/g) || [];
      return importantWords.filter(word => word.length > 1).slice(0, 5);
    };

    // ç›®æ¨™ã®ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®š
    const determineGoalType = (text) => {
      if (text.includes('å¥åº·') || text.includes('é‹å‹•') || text.includes('ãƒ€ã‚¤ã‚¨ãƒƒãƒˆ')) {
        return 'å¥åº·ãƒ»ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹';
      } else if (text.includes('å‹‰å¼·') || text.includes('å­¦ç¿’') || text.includes('è³‡æ ¼')) {
        return 'å­¦ç¿’ãƒ»ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—';
      } else if (text.includes('ä»•äº‹') || text.includes('ã‚­ãƒ£ãƒªã‚¢') || text.includes('è»¢è·')) {
        return 'ã‚­ãƒ£ãƒªã‚¢ãƒ»ä»•äº‹';
      } else if (text.includes('ãŠé‡‘') || text.includes('è²¯é‡‘') || text.includes('æŠ•è³‡')) {
        return 'çµŒæ¸ˆãƒ»è²¡å‹™';
      } else if (text.includes('äººé–“é–¢ä¿‚') || text.includes('æ‹æ„›') || text.includes('å®¶æ—')) {
        return 'äººé–“é–¢ä¿‚';
      } else {
        return 'è‡ªå·±å®Ÿç¾';
      }
    };

    // å…·ä½“çš„ãªè¡Œå‹•ã‚’æŠ½å‡º
    const extractActions = (text) => {
      const actionPatterns = [
        /æ¯æ—¥[^ã€‚ã€]+/g,
        /[^ã€‚ã€]+ã™ã‚‹/g,
        /[^ã€‚ã€]+ã—ãŸã„/g,
        /[^ã€‚ã€]+ã«ãªã‚‹/g
      ];
      
      let actions = [];
      actionPatterns.forEach(pattern => {
        const matches = text.match(pattern) || [];
        actions = actions.concat(matches);
      });
      
      return [...new Set(actions)].slice(0, 3);
    };

    // æœŸé™ã‚’æŠ½å‡º
    const extractTimeline = (text) => {
      const timePatterns = [
        /\d+å¹´/g,
        /\d+ãƒ¶æœˆ/g,
        /\d+æœˆ/g,
        /æ¥å¹´/g,
        /ä»Šå¹´/g,
        /æ¯æ—¥/g,
        /æ¯é€±/g
      ];
      
      for (let pattern of timePatterns) {
        const match = text.match(pattern);
        if (match) {
          return match[0];
        }
      }
      return 'ç¶™ç¶šçš„ã«';
    };

    // æ„Ÿæƒ…çš„ãªè¦ç´ ã‚’æŠ½å‡º
    const extractEmotions = (text) => {
      const positiveWords = ['æ¥½ã—ã„', 'å¬‰ã—ã„', 'å¹¸ã›', 'å……å®Ÿ', 'é”æˆæ„Ÿ', 'è‡ªä¿¡', 'èª‡ã‚Š', 'å–œã³'];
      const found = positiveWords.filter(word => text.includes(word));
      
      if (found.length === 0) {
        return ['å……å®Ÿæ„Ÿ', 'é”æˆæ„Ÿ', 'å–œã³'];
      }
      return found;
    };

    return {
      original: goalText,
      keywords: extractKeywords(goalText),
      type: determineGoalType(goalText),
      actions: extractActions(goalText),
      timeline: extractTimeline(goalText),
      emotions: extractEmotions(goalText)
    };
  };

  const createAffirmation = (analysis) => {
    const mainAction = analysis.actions[0] || 'ç›®æ¨™ã«å‘ã‹ã£ã¦é€²ã‚“ã§ã„ã‚‹';
    
    let situation = `ç§ã¯${analysis.timeline}`;
    if (mainAction.includes('æ¯æ—¥')) {
      situation += mainAction;
    } else {
      situation += `ã€${mainAction}`;
    }
    
    let visualization = `ç§ã¯${analysis.type}ã®åˆ†é‡ã§ç€å®Ÿã«æˆé•·ã—ã€`;
    if (analysis.keywords.length > 0) {
      visualization += `${analysis.keywords[0]}ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹`;
    } else {
      visualization += 'ç†æƒ³ã®è‡ªåˆ†ã«è¿‘ã¥ã„ã¦ã„ã‚‹';
    }
    
    const emotion = analysis.emotions[0] || 'å……å®Ÿæ„Ÿ';
    let emotional = `ã“ã®éç¨‹ã‚’é€šã˜ã¦ã€ç§ã¯${emotion}ã‚’æ„Ÿã˜ã€æ¯æ—¥ãŒã‚ˆã‚Šè±Šã‹ã«ãªã£ã¦ã„ã‚‹`;
    
    const affirmation = `${situation}ã€‚${visualization}ã€‚${emotional}ã€‚ç§ã¯è‡ªåˆ†ã®æˆé•·ã‚’å®Ÿæ„Ÿã—ã€ç›®æ¨™é”æˆã«å‘ã‹ã£ã¦ç¢ºå®Ÿã«å‰é€²ã—ã¦ã„ã‚‹ã“ã¨ã‚’å¿ƒã‹ã‚‰å–œã‚“ã§ã„ã‚‹ã€‚`;
    
    return {
      full: affirmation,
      situation: situation,
      visualization: visualization,
      emotional: emotional
    };
  };

  const generateAffirmation = async () => {
    if (!goal.trim()) {
      alert('ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      return;
    }

    setIsLoading(true);
    
    try {
      // åˆ†æå‡¦ç†ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã§ã¯APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«é€ä¿¡ï¼‰
      await new Promise(resolve => setTimeout(resolve, 500)); // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
      
      const analysis = analyzeGoal(goal);
      const affirmation = createAffirmation(analysis);
      
      setResults({
        affirmation,
        analysis
      });
    } catch (error) {
      console.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
      alert('ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
    } finally {
      setIsLoading(false);
    }
  };

  const resetForm = () => {
    setGoal('');
    setResults(null);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center p-4">
      <div className="bg-white bg-opacity-95 rounded-2xl shadow-2xl p-8 max-w-4xl w-full">
        <h1 className="text-3xl font-bold text-center text-gray-800 mb-2">
          ğŸ¯ ç›®æ¨™é”æˆã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆã‚¢ãƒ—ãƒª
        </h1>
        <p className="text-center text-gray-600 mb-8 text-lg">
          ã‚ãªãŸã®ç›®æ¨™ã‚’åŠ¹æœçš„ãªã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤‰æ›ã—ã¾ã™
        </p>

        <div className="mb-8">
          <label htmlFor="goalInput" className="block text-gray-700 font-semibold mb-3">
            ã‚ãªãŸã®ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š
          </label>
          <textarea
            id="goalInput"
            value={goal}
            onChange={(e) => setGoal(e.target.value)}
            maxLength={3000}
            rows={6}
            className="w-full p-4 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition-colors resize-vertical"
            placeholder="ä¾‹ï¼šæ¥å¹´ã¾ã§ã«è‹±èªã‚’æµæš¢ã«è©±ã›ã‚‹ã‚ˆã†ã«ãªã‚ŠãŸã„ã€‚æ¯æ—¥å‹‰å¼·ã—ã¦ã€TOEICã§900ç‚¹ä»¥ä¸Šã‚’å–ã‚ŠãŸã„..."
          />
          <div className="text-right text-gray-500 text-sm mt-2">
            {goal.length} / 3000æ–‡å­—
          </div>
        </div>

        <button
          onClick={generateAffirmation}
          disabled={isLoading}
          className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 px-8 rounded-full hover:shadow-lg transform hover:-translate-y-1 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isLoading ? 'ç”Ÿæˆä¸­...' : 'ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã™ã‚‹'}
        </button>

        {results && (
          <div className="mt-10 animate-fade-in">
            <div className="bg-gray-50 rounded-xl p-6 mb-6 border-l-4 border-purple-500">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">
                âœ¨ ã‚ãªãŸã®ç›®æ¨™é”æˆã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
              </h2>
              <div className="bg-white p-5 rounded-lg shadow-sm text-lg leading-relaxed text-gray-700">
                {results.affirmation.full}
              </div>
            </div>

            <div className="bg-gray-50 rounded-xl p-6 mb-6 border-l-4 border-purple-500">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">
                ğŸ“Š ç›®æ¨™ã®åˆ†æ
              </h2>
              <div className="space-y-3">
                <div className="bg-white p-4 rounded-lg shadow-sm">
                  <span className="font-semibold text-purple-600">ç›®æ¨™ã®ã‚¿ã‚¤ãƒ—:</span>
                  <span className="ml-2 text-gray-700">{results.analysis.type}</span>
                </div>
                {results.analysis.keywords.length > 0 && (
                  <div className="bg-white p-4 rounded-lg shadow-sm">
                    <span className="font-semibold text-purple-600">ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰:</span>
                    <span className="ml-2 text-gray-700">{results.analysis.keywords.join('ã€')}</span>
                  </div>
                )}
                <div className="bg-white p-4 rounded-lg shadow-sm">
                  <span className="font-semibold text-purple-600">æœŸé™ãƒ»é »åº¦:</span>
                  <span className="ml-2 text-gray-700">{results.analysis.timeline}</span>
                </div>
                {results.analysis.actions.length > 0 && (
                  <div className="bg-white p-4 rounded-lg shadow-sm">
                    <span className="font-semibold text-purple-600">å…·ä½“çš„ãªè¡Œå‹•:</span>
                    <span className="ml-2 text-gray-700">{results.analysis.actions.join('ã€')}</span>
                  </div>
                )}
              </div>
            </div>

            <div className="bg-gray-50 rounded-xl p-6 mb-6 border-l-4 border-purple-500">
              <h2 className="text-2xl font-bold text-gray-800 mb-4">
                ğŸ¯ 3ã¤ã®ãƒã‚¤ãƒ³ãƒˆ
              </h2>
              <div className="space-y-3">
                <div className="bg-white p-4 rounded-lg shadow-sm">
                  <span className="font-semibold text-purple-600">1. çŠ¶æ³:</span>
                  <div className="mt-1 text-gray-700">{results.affirmation.situation}</div>
                </div>
                <div className="bg-white p-4 rounded-lg shadow-sm">
                  <span className="font-semibold text-purple-600">2. æ˜ åƒ:</span>
                  <div className="mt-1 text-gray-700">{results.affirmation.visualization}</div>
                </div>
                <div className="bg-white p-4 rounded-lg shadow-sm">
                  <span className="font-semibold text-purple-600">3. æ„Ÿæƒ…:</span>
                  <div className="mt-1 text-gray-700">{results.affirmation.emotional}</div>
                </div>
              </div>
            </div>

            <div className="bg-yellow-50 border border-yellow-200 rounded-xl p-6 mb-6">
              <h3 className="text-xl font-bold text-yellow-800 mb-3">
                ğŸ“… æ—¥å¸¸çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³
              </h3>
              <ul className="space-y-2 text-yellow-800">
                <li className="flex items-start">
                  <span className="mr-2">â€¢</span>
                  <div>
                    <strong>æ¯æœã®ã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:</strong> ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ•ã‚¡ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å£°ã«å‡ºã—ã¦èª­ã‚€
                  </div>
                </li>
                <li className="flex items-start">
                  <span className="mr-2">â€¢</span>
                  <div>
                    <strong>é€±æ¬¡é€²æ—ç¢ºèª:</strong> æ¯é€±æ—¥æ›œæ—¥ã«é€²æ—ã‚’æŒ¯ã‚Šè¿”ã‚‹
                  </div>
                </li>
                <li className="flex items-start">
                  <span className="mr-2">â€¢</span>
                  <div>
                    <strong>å¿ƒèº«ã®ã‚±ã‚¢:</strong> å®šæœŸçš„ãªé‹å‹•ã‚„ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šå…¥ã‚Œã‚‹
                  </div>
                </li>
              </ul>
            </div>

            <button
              onClick={resetForm}
              className="w-full bg-red-500 text-white font-bold py-3 px-6 rounded-full hover:bg-red-600 transition-colors"
            >
              æ–°ã—ã„ç›®æ¨™ã‚’å…¥åŠ›ã™ã‚‹
            </button>
          </div>
        )}
      </div>

      <style jsx>{`
        @keyframes fade-in {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .animate-fade-in {
          animation: fade-in 0.5s ease-out;
        }
      `}</style>
    </div>
  );
}
